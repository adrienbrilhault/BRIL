<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>BRIL algorithm applied to eye-tracking calibration • BRIL</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="BRIL algorithm applied to eye-tracking calibration">
<meta property="og:description" content="BRIL">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-200250973-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-200250973-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">BRIL</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">1.0.3</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Notebooks
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/demo_ArtificialData.html">Demo Artificial Data</a>
    </li>
    <li>
      <a href="../articles/demo_EyeTrackingData.html">Demo Eye-tracking Data</a>
    </li>
  </ul>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/adrienbrilhault/BRIL/">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><script src="demo_EyeTrackingData_files/header-attrs-2.9/header-attrs.js"></script><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>BRIL algorithm applied to eye-tracking calibration</h1>
            
      
      <small class="dont-index">Source: <a href="https://github.com/adrienbrilhault/BRIL/blob/master/demo_EyeTrackingData.ipynb"><code>demo_EyeTrackingData.ipynb</code></a></small>
      <div class="hidden name"><code>demo_EyeTrackingData.Rmd</code></div>

    </div>

    
    
<p><br></p>
<p>This notebook presents the application of the BRIL algorithm to real-world datasets, as complementary material of the article :</p>
<p><em>Brilhault A, Neuenschwander S, Rios RA, “A New Robust Multivariate Mode Estimator for Eye-tracking Calibration”, 2021, Behavior Research Methods <a href="https://arxiv.org/abs/2107.08030">(submitted)</a></em></p>
<p>The data consists of eye-tracking calibrations recorded in the context of visual studies in capuchins (carried out at the Brain Institute of the Federal University of Rio Grande de Norte, Brazil). Eye positions were recorded using the eye-tracking setup developed by <a href="https://staff.aist.go.jp/k.matsuda/iRecHS2/index_e.html">Matsuda Keiji et al.</a>. The system relies on a PointGrey Grasshopper3 infrared camera (GS3-U3-41C6NIR-C). Image acquisition was set at a frequency of 235Hz. The eye coordinate signals generated by the system were recorded through an acquisition board (National Instruments E-Series board), at a sampling frequency of 1000 samples/s.</p>
<p>We demonstrate the robustness of our algorithm, BRIL, in estimating the reference coordinates for each calibration target despite the highly contaminated data resulting from the subjects lack of attention or cooperation. Note that the three datasets presented in the article as <em>Set1</em>, <em>Set2</em>, and <em>Set3</em> (with low, medium, and high contamination) correspond to the sessions <em>juj011a00</em>, <em>ded00800</em>, and <em>ded005a01</em>, respectivly.</p>
<p>To run this notebook interactively, follow the link below:</p>
<p><a href="https://mybinder.org/v2/gh/adrienbrilhault/BRIL/HEAD?filepath=demo_EyeTrackingData.ipynb"><img src="https://mybinder.org/badge_logo.svg" alt="Binder"></a></p>
<div id="requirements" class="section level2">
<h2 class="hasAnchor">
<a href="#requirements" class="anchor"></a>Requirements</h2>
<p>The following R packages are required for the execution of the notebook:</p>
<ul>
<li>
<a href="https://www.tidyverse.org/">tidyverse</a> (install using the command <code>install.package("tidyverse")</code>)</li>
<li>
<a href="https://github.com/adrienbrilhault/BRIL">BRIL</a> (first install the package <a href="https://github.com/r-lib/remotes">remotes</a> if missing: <code>install.package("remotes")</code>, then the BRIL package with <code><a href="https://remotes.r-lib.org/reference/install_github.html">remotes::install_github("adrienbrilhault/BRIL", subdir = "pkg")</a></code>)</li>
</ul>
</div>
<div id="libraries-and-dataset-loading" class="section level2">
<h2 class="hasAnchor">
<a href="#libraries-and-dataset-loading" class="anchor"></a>Libraries and dataset loading</h2>
<p>The horizontal and vertical eye-positions recorded during the calibrations are stored in the variables <code>x</code> and <code>y</code>, respectively. Each consist of a matrix, rows corresponding to single trials, and columns to the successive measurements within the trials (1 per millisecond, since the data was acquired at 1000hz). <code>Metadata</code>, having the same number of rows, contains the information relative to each trial in <code>x</code> and <code>y</code>, namely the session, trial number, target presented, total the number of trials and targets for the corresponding session, as well as the durations of the recording (in ms). Note that as the duration varies from a session to another, the tables <code>x</code> and <code>y</code> were filled with <code>NA</code> until the end of the rows in shorter trials.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Load libraries</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://adrienbrilhault.github.io/BRIL/">BRIL</a></span><span class="op">)</span><span class="op">)</span>
<span class="fu"><a href="https://rdrr.io/r/base/message.html">suppressPackageStartupMessages</a></span><span class="op">(</span><span class="kw"><a href="https://rdrr.io/r/base/library.html">library</a></span><span class="op">(</span><span class="va"><a href="https://tidyverse.tidyverse.org">tidyverse</a></span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## Warning: package 'tidyverse' was built under R version 4.0.5</code></pre>
<pre><code>## Warning: package 'tibble' was built under R version 4.0.5</code></pre>
<pre><code>## Warning: package 'tidyr' was built under R version 4.0.5</code></pre>
<pre><code>## Warning: package 'dplyr' was built under R version 4.0.5</code></pre>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co">## Load data</span>
<span class="fu"><a href="https://rdrr.io/r/base/rm.html">rm</a></span><span class="op">(</span>list<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span>
<span class="co">#load("Data/eyeTrackingCalibrations.Rdata")</span>
<span class="fu"><a href="https://rdrr.io/r/base/load.html">load</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/gzcon.html">gzcon</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/connections.html">url</a></span><span class="op">(</span><span class="st">'https://github.com/adrienbrilhault/BRIL/raw/master/data/eyeTrackingCalibrations.Rdata'</span><span class="op">)</span><span class="op">)</span><span class="op">)</span>

<span class="co">## Print preview of the data</span>
<span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"Variables:\n"</span><span class="op">)</span></code></pre></div>
<pre><code>## Variables:</code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/ls.html">ls</a></span><span class="op">(</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "groundTruth" "metadata"    "x"           "y"</code></pre>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\nmetadata: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span>, <span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/typeof.html">typeof</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span>, <span class="st">"), dim"</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">)</span>, <span class="st">" \n"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## metadata:  data.frame ( list ), dim 240 6</code></pre>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">[</span><span class="fl">1</span><span class="op">:</span><span class="fl">5</span>, <span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>##     session trial nTrials duration target nTargets
## 1 ded005a01     1      50     3000      4        5
## 2 ded005a01     2      50     3000      2        5
## 3 ded005a01     3      50     3000      5        5
## 4 ded005a01     4      50     3000      2        5
## 5 ded005a01     5      50     3000      4        5</code></pre>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\nSessions: \n"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## Sessions:</code></pre>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">$</span><span class="va">session</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></code></pre></div>
<pre><code>## [1] "ded005a01" "ded006a00" "ded00800"  "juj00300"  "juj011a00"</code></pre>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\nx: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/typeof.html">typeof</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">"), dim"</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">x</span><span class="op">)</span>, <span class="st">" \n"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## x:  matrix array ( integer ), dim 240 3000</code></pre>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="fl">0</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1]  14199  21703  22505  22514  17203  18172  22400  21573 -32768  20824</code></pre>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/cat.html">cat</a></span><span class="op">(</span><span class="st">"\ny: "</span>, <span class="fu"><a href="https://rdrr.io/r/base/class.html">class</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, <span class="st">"("</span>, <span class="fu"><a href="https://rdrr.io/r/base/typeof.html">typeof</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, <span class="st">"), dim"</span>, <span class="fu"><a href="https://rdrr.io/r/base/dim.html">dim</a></span><span class="op">(</span><span class="va">y</span><span class="op">)</span>, <span class="st">" \n"</span><span class="op">)</span></code></pre></div>
<pre><code>## 
## y:  matrix array ( integer ), dim 240 3000</code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="fl">0</span><span class="op">:</span><span class="fl">10</span><span class="op">]</span><span class="op">)</span></code></pre></div>
<pre><code>##  [1]  -2467 -10002   1037  -9699  -6936    607    834  -9940 -32768  -8358</code></pre>
</div>
<div id="summary-statistics" class="section level2">
<h2 class="hasAnchor">
<a href="#summary-statistics" class="anchor"></a>Summary statistics</h2>
<p>Since one calibration point is drawn randomly within the 5 calibration targets at each trial, the number of trials per target within one session may vary. The table below shows the characteristics of each session, with the number of samples collected for each of the targets, as well as the number of valid samples, once incorrect positions have been filtered out (these being the result of eye blinks, artifacts, or saturated values from the analog acquisition board).</p>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="va">summary</span> <span class="op">&lt;-</span> <span class="va">metadata</span> <span class="op">%&gt;%</span>
  <span class="fu">select</span><span class="op">(</span><span class="va">session</span>, <span class="va">duration</span>, <span class="va">nTrials</span>, <span class="va">nTargets</span>, <span class="va">target</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">arrange</span><span class="op">(</span><span class="va">session</span>, <span class="va">target</span><span class="op">)</span> <span class="op">%&gt;%</span>
  <span class="fu">distinct_all</span><span class="op">(</span><span class="op">)</span>

<span class="va">summary</span><span class="op">$</span><span class="va">nTrialsTarget</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">summary</span><span class="op">$</span><span class="va">nSamples</span> <span class="op">&lt;-</span> <span class="cn">NA</span>
<span class="va">summary</span><span class="op">$</span><span class="va">nValidSamples</span> <span class="op">&lt;-</span> <span class="cn">NA</span>

<span class="kw">for</span> <span class="op">(</span><span class="va">i</span> <span class="kw">in</span> <span class="fl">1</span><span class="op">:</span><span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">selectedIndices</span> <span class="op">&lt;-</span> <span class="va">metadata</span><span class="op">$</span><span class="va">session</span> <span class="op">==</span> <span class="va">summary</span><span class="op">$</span><span class="va">session</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&amp;</span>
    <span class="va">metadata</span><span class="op">$</span><span class="va">target</span> <span class="op">==</span> <span class="va">summary</span><span class="op">$</span><span class="va">target</span><span class="op">[</span><span class="va">i</span><span class="op">]</span>

  <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
    X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">selectedIndices</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span>,
    Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">selectedIndices</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span>
  <span class="op">)</span>

  <span class="co"># Remove trailing NA fill</span>
  <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">X</span><span class="op">)</span> <span class="op">|</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span>, <span class="op">]</span>
  <span class="va">summary</span><span class="op">$</span><span class="va">nSamples</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
  <span class="co"># Remove overflowed values and error codes from eyetracker</span>
  <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">X</span> <span class="op">!=</span> <span class="op">-</span><span class="fl">32768</span> <span class="op">&amp;</span> <span class="va">df</span><span class="op">$</span><span class="va">Y</span> <span class="op">!=</span> <span class="op">-</span><span class="fl">32768</span>, <span class="op">]</span>
  <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">X</span> <span class="op">!=</span> <span class="fl">32767</span> <span class="op">&amp;</span> <span class="va">df</span><span class="op">$</span><span class="va">Y</span> <span class="op">!=</span> <span class="fl">32767</span>, <span class="op">]</span>

  <span class="va">summary</span><span class="op">$</span><span class="va">nTrialsTarget</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html">sum</a></span><span class="op">(</span><span class="va">selectedIndices</span><span class="op">)</span>
  <span class="va">summary</span><span class="op">$</span><span class="va">nValidSamples</span><span class="op">[</span><span class="va">i</span><span class="op">]</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/nrow.html">nrow</a></span><span class="op">(</span><span class="va">df</span><span class="op">)</span>
<span class="op">}</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>
<span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span>
  <span class="st">"Session"</span>, <span class="st">"Duration"</span>, <span class="st">"TotalTrials"</span>, <span class="st">"TotalTargets"</span>,
  <span class="st">"Target"</span>, <span class="st">"TargetTrials"</span>, <span class="st">"Samples"</span>, <span class="st">"ValidSamples"</span>
<span class="op">)</span>

<span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">summary</span><span class="op">)</span></code></pre></div>
<pre><code>##      Session Duration TotalTrials TotalTargets Target TargetTrials Samples
## 1  ded005a01     3000          50            5      1            6   18000
## 2  ded005a01     3000          50            5      2            8   24000
## 3  ded005a01     3000          50            5      3           10   30000
## 4  ded005a01     3000          50            5      4           19   57000
## 5  ded005a01     3000          50            5      5            7   21000
## 6  ded006a00     2200          40            5      1            9   19800
## 7  ded006a00     2200          40            5      2            4    8800
## 8  ded006a00     2200          40            5      3            8   17600
## 9  ded006a00     2200          40            5      4            8   17600
## 10 ded006a00     2200          40            5      5           11   24200
## 11  ded00800     1200          50            5      1           12   14400
## 12  ded00800     1200          50            5      2           10   12000
## 13  ded00800     1200          50            5      3            7    8400
## 14  ded00800     1200          50            5      4           11   13200
## 15  ded00800     1200          50            5      5           10   12000
## 16  juj00300     1700          50            5      1            7   11900
## 17  juj00300     1700          50            5      2            8   13600
## 18  juj00300     1700          50            5      3           12   20400
## 19  juj00300     1700          50            5      4           12   20400
## 20  juj00300     1700          50            5      5           11   18700
## 21 juj011a00     1700          50            5      1            7   11900
## 22 juj011a00     1700          50            5      2           14   23800
## 23 juj011a00     1700          50            5      3           12   20400
## 24 juj011a00     1700          50            5      4            6   10200
## 25 juj011a00     1700          50            5      5           11   18700
##    ValidSamples
## 1         15607
## 2         21318
## 3         26602
## 4         46419
## 5         18536
## 6         16047
## 7          7353
## 8         14841
## 9         14875
## 10        20252
## 11        11122
## 12        11016
## 13         7637
## 14        12127
## 15        11022
## 16        11850
## 17        13077
## 18        20258
## 19        20371
## 20        18670
## 21        11900
## 22        23175
## 23        20400
## 24         8951
## 25        18700</code></pre>
</div>
<div id="filter-data-for-a-given-session-and-target" class="section level2">
<h2 class="hasAnchor">
<a href="#filter-data-for-a-given-session-and-target" class="anchor"></a>Filter data for a given session and target</h2>
<p>Process one sample distribution, pooling all the trials for a specific session and target. Filter the incorrect sample, then apply the BRIL algorithm to estimate the main mode.</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="fu"><a href="https://rdrr.io/r/base/Random.html">set.seed</a></span><span class="op">(</span><span class="fl">123</span><span class="op">)</span>

<span class="co"># Select a session and target number</span>
<span class="va">session</span> <span class="op">&lt;-</span> <span class="st">"ded005a01"</span>
<span class="va">target</span> <span class="op">&lt;-</span> <span class="fl">1</span>

<span class="co"># Filter the corresponding trials</span>
<span class="va">selectedIndices</span> <span class="op">&lt;-</span> <span class="va">metadata</span><span class="op">$</span><span class="va">session</span> <span class="op">==</span> <span class="va">session</span> <span class="op">&amp;</span> <span class="va">metadata</span><span class="op">$</span><span class="va">target</span> <span class="op">==</span> <span class="va">target</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
  X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">selectedIndices</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span>,
  Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">selectedIndices</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span>
<span class="op">)</span>

<span class="co"># Remove trailing NA fill</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">X</span><span class="op">)</span> <span class="op">|</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span>, <span class="op">]</span>

<span class="co"># Remove overflowed values and error codes from eyetracker</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">X</span> <span class="op">!=</span> <span class="op">-</span><span class="fl">32768</span> <span class="op">&amp;</span> <span class="va">df</span><span class="op">$</span><span class="va">Y</span> <span class="op">!=</span> <span class="op">-</span><span class="fl">32768</span>, <span class="op">]</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">X</span> <span class="op">!=</span> <span class="fl">32767</span> <span class="op">&amp;</span> <span class="va">df</span><span class="op">$</span><span class="va">Y</span> <span class="op">!=</span> <span class="fl">32767</span>, <span class="op">]</span>

<span class="co"># Draw 1000 random samples and estimate the mode with the BRIL method</span>
<span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">sample_n</span><span class="op">(</span><span class="va">df</span>, <span class="fl">1000</span><span class="op">)</span>
<span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bril.html">bril</a></span><span class="op">(</span><span class="va">df</span>, method <span class="op">=</span> <span class="st">"Projection"</span>, testNormal <span class="op">=</span> <span class="st">"Mardia"</span>, maxIterations <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>

<span class="co"># Plot the result</span>
<span class="fu"><a href="https://rdrr.io/r/base/options.html">options</a></span><span class="op">(</span>jupyter.plot_mimetypes <span class="op">=</span> <span class="st">"image/svg+xml"</span><span class="op">)</span>
<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/theme_get.html">theme_set</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html">theme_bw</a></span><span class="op">(</span>base_size <span class="op">=</span> <span class="fl">16</span><span class="op">)</span><span class="op">)</span>


<span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">df</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">2</span>, shape <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span><span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">mode</span><span class="op">[</span><span class="fl">1</span><span class="op">]</span>, y <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">mode</span><span class="op">[</span><span class="fl">2</span><span class="op">]</span><span class="op">)</span>,
    colour <span class="op">=</span> <span class="st">"red"</span>,
    shape <span class="op">=</span> <span class="fl">3</span>, size <span class="op">=</span> <span class="fl">3</span>, stroke <span class="op">=</span> <span class="fl">2</span>
  <span class="op">)</span> <span class="op">+</span>
  <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span>, expand <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></code></pre></div>
<p><img src="demo_EyeTrackingData_files/figure-html/unnamed-chunk-3-1.svg" width="700.8"></p>
</div>
<div id="process-a-complete-calibration-procedure" class="section level2">
<h2 class="hasAnchor">
<a href="#process-a-complete-calibration-procedure" class="anchor"></a>Process a complete calibration procedure</h2>
<p>Apply the same procedure as above for each of the targets of one or several sessions, plotting the final result with each sample displayed in a color corresponding to the target that was presented at the time of the recording.</p>
<div class="sourceCode" id="cb29"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span class="co"># Select one or several sessions to process</span>
<span class="va">sessions</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"ded005a01"</span><span class="op">)</span>

<span class="co"># Analyze each session</span>
<span class="kw">for</span> <span class="op">(</span><span class="va">session</span> <span class="kw">in</span> <span class="va">sessions</span><span class="op">)</span> <span class="op">{</span>
  <span class="va">dfCalibration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="op">)</span>
  <span class="va">dfModes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="op">)</span>

  <span class="co"># Iterate through each target within the session</span>
  <span class="kw">for</span> <span class="op">(</span><span class="va">target</span> <span class="kw">in</span> <span class="fu"><a href="https://rdrr.io/r/base/sort.html">sort</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/unique.html">unique</a></span><span class="op">(</span><span class="va">metadata</span><span class="op">$</span><span class="va">target</span><span class="op">[</span><span class="va">metadata</span><span class="op">$</span><span class="va">session</span> <span class="op">==</span> <span class="va">session</span><span class="op">]</span><span class="op">)</span><span class="op">)</span><span class="op">)</span> <span class="op">{</span>

    <span class="co"># Filter the corresponding trials</span>
    <span class="va">selectedIndices</span> <span class="op">&lt;-</span> <span class="va">metadata</span><span class="op">$</span><span class="va">session</span> <span class="op">==</span> <span class="va">session</span> <span class="op">&amp;</span> <span class="va">metadata</span><span class="op">$</span><span class="va">target</span> <span class="op">==</span> <span class="va">target</span>
    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span>
      X <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">x</span><span class="op">[</span><span class="va">selectedIndices</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span>,
      Y <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/vector.html">as.vector</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/t.html">t</a></span><span class="op">(</span><span class="va">y</span><span class="op">[</span><span class="va">selectedIndices</span>, <span class="op">]</span><span class="op">)</span><span class="op">)</span>
    <span class="op">)</span>

    <span class="co"># Remove trailing NA fill</span>
    <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">X</span><span class="op">)</span> <span class="op">|</span> <span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html">is.na</a></span><span class="op">(</span><span class="va">df</span><span class="op">$</span><span class="va">Y</span><span class="op">)</span>, <span class="op">]</span>

    <span class="co"># Remove overflowed values and error codes from eye-tracker</span>
    <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">X</span> <span class="op">!=</span> <span class="op">-</span><span class="fl">32768</span> <span class="op">&amp;</span> <span class="va">df</span><span class="op">$</span><span class="va">Y</span> <span class="op">!=</span> <span class="op">-</span><span class="fl">32768</span>, <span class="op">]</span>
    <span class="va">df</span> <span class="op">&lt;-</span> <span class="va">df</span><span class="op">[</span><span class="va">df</span><span class="op">$</span><span class="va">X</span> <span class="op">!=</span> <span class="fl">32767</span> <span class="op">&amp;</span> <span class="va">df</span><span class="op">$</span><span class="va">Y</span> <span class="op">!=</span> <span class="fl">32767</span>, <span class="op">]</span>

    <span class="co"># Draw 1000 random samples and estimate the mode</span>
    <span class="va">df</span> <span class="op">&lt;-</span> <span class="fu">sample_n</span><span class="op">(</span><span class="va">df</span>, <span class="fl">1000</span><span class="op">)</span>
    <span class="va">res</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/bril.html">bril</a></span><span class="op">(</span><span class="va">df</span>, method <span class="op">=</span> <span class="st">"L2"</span>, testNormal <span class="op">=</span> <span class="st">"Mardia"</span>, maxIterations <span class="op">=</span> <span class="fl">5</span><span class="op">)</span>

    <span class="co"># Update structures</span>
    <span class="va">df</span><span class="op">$</span><span class="va">Target</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Target"</span>, <span class="va">target</span><span class="op">)</span>
    <span class="va">dfCalibration</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">dfCalibration</span>, <span class="va">df</span><span class="op">)</span>
    <span class="va">dfModes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/cbind.html">rbind</a></span><span class="op">(</span><span class="va">dfModes</span>, <span class="va">res</span><span class="op">$</span><span class="va">mode</span><span class="op">)</span>
  <span class="op">}</span>

  <span class="co"># Plot samples and mode</span>
  <span class="va">dfModes</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/data.frame.html">data.frame</a></span><span class="op">(</span><span class="va">dfModes</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">colnames</a></span><span class="op">(</span><span class="va">dfModes</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span><span class="op">(</span><span class="st">"X"</span>, <span class="st">"Y"</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/colnames.html">rownames</a></span><span class="op">(</span><span class="va">dfModes</span><span class="op">)</span> <span class="op">&lt;-</span> <span class="cn">NULL</span>

  <span class="va">g</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggplot.html">ggplot</a></span><span class="op">(</span><span class="va">dfCalibration</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span>, color <span class="op">=</span> <span class="va">Target</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>size <span class="op">=</span> <span class="fl">1</span>, shape <span class="op">=</span> <span class="fl">1</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/geom_point.html">geom_point</a></span><span class="op">(</span>
      data <span class="op">=</span> <span class="va">dfModes</span>, <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">X</span>, y <span class="op">=</span> <span class="va">Y</span><span class="op">)</span>,
      colour <span class="op">=</span> <span class="st">"black"</span>, shape <span class="op">=</span> <span class="fl">3</span>, size <span class="op">=</span> <span class="fl">2</span>, stroke <span class="op">=</span> <span class="fl">2</span>
    <span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/coord_fixed.html">coord_fixed</a></span><span class="op">(</span>ratio <span class="op">=</span> <span class="fl">1</span>, expand <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span> <span class="op">+</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/labs.html">ggtitle</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste</a></span><span class="op">(</span><span class="st">"Session"</span>,<span class="va">session</span><span class="op">)</span><span class="op">)</span>
  <span class="fu"><a href="https://rdrr.io/r/base/print.html">print</a></span><span class="op">(</span><span class="va">g</span><span class="op">)</span>

  <span class="co"># save image</span>
  <span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span>
    <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggsave.html">ggsave</a></span><span class="op">(</span><span class="va">g</span>, filename <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span><span class="op">(</span><span class="st">"calibration_"</span>, <span class="va">session</span>, <span class="st">".jpg"</span><span class="op">)</span>, width <span class="op">=</span> <span class="fl">7</span>, height <span class="op">=</span> <span class="fl">6</span><span class="op">)</span>
  <span class="op">}</span>
<span class="op">}</span></code></pre></div>
<p><img src="demo_EyeTrackingData_files/figure-html/unnamed-chunk-4-1.svg" width="700.8"></p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by <a href="https://www.linkedin.com/in/adrienbrilhault/">Adrien Brilhault</a>.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.6.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
